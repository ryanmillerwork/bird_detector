#
# Example .env for both runtime (birdwatch.py) and training (train_classifier.py).
#
# Notes:
# - `birdwatch.py` loads `.env` at startup, but real environment variables take precedence.
# - This file is meant to be copied to `.env` and edited.
#

# -----------------------
# Runtime (birdwatch.py)
# -----------------------

# Frigate JPEG snapshot source (default builds JPEG_URL as http://$FRIGATE_HOST/api/$FRIGATE_CAMERA/latest.jpg)
FRIGATE_HOST=192.168.0.50:5000
FRIGATE_CAMERA=bird
# Optional explicit override:
# JPEG_URL=http://192.168.0.50:5000/api/bird/latest.jpg

# Capture tuning
JPEG_TIMEOUT_S=3.0
CAPTURE_INTERVAL_S=2.0

# Detection tuning
DETECT_CONF=0.25
DETECT_PADDING=100
KEEP_LAST_ANNOTATED=10

# TTS (Piper) + optional bird songs
TTS_ENABLED=1
# TTS_PIPER_MODEL=./tts_models/piper/en_US-libritts_r-medium.onnx
TTS_MIN_CONF=0.0
TTS_COOLDOWN_S=15
TTS_MAX_QUEUE=10
TTS_PREROLL_MS=650
BIRD_SONGS_ENABLED=1
# BIRD_SONGS_DIR=./bird_songs
BIRD_SONGS_MAX_S=10
TTS_SAME_SPECIES_REPEAT_S=60
BIRD_SONGS_EVERY_S=10

# -----------------------
# MQTT (optional)
# -----------------------
#
# Publishes:
# - bird_detector/event (non-retained): one message per frame where detections exist
# - bird_detector/state (retained): latest event payload for dashboards
#
# Home Assistant: Developer Tools -> MQTT -> Listen to `bird_detector/#`
#
# MQTT_ENABLED=0           # set to 0 to disable (default is enabled)
# MQTT_HOST=192.168.0.84
# MQTT_PORT=1883
# MQTT_USER=bird_detector
# MQTT_PASS=secret
# MQTT_TOPIC_EVENT=bird_detector/event
# MQTT_TOPIC_STATE=bird_detector/state
# MQTT_CLIENT_ID=bird_detector
# MQTT_QOS=0
# MQTT_RETAIN_STATE=1

# -----------------------
# HTTP server for detections/latest.jpg (optional)
# -----------------------
#
# Default behavior: `birdwatch.py` starts this server automatically.
# (Set DETECTIONS_HTTP_ENABLED=0 to disable.)
#
# Or run standalone:
#   python serve_detections.py
#
# Then `latest.jpg` will be accessible to other machines (like Home Assistant).
#
# DETECTIONS_HTTP_ENABLED=1
# DETECTIONS_HTTP_HOST=0.0.0.0
# DETECTIONS_HTTP_PORT=8765
# DETECTIONS_DIR=./detections
#
# Include this in MQTT payloads as `annotated_image_url`:
# DETECTIONS_BASE_URL=http://192.168.0.60:8765

# -----------------------
# Training (train_classifier.py)
# -----------------------
DATA_DIR=hand_sorted
OUTPUT_DIR=models
BATCH_SIZE=16
NUM_WORKERS=4

# -----------------------
# Postgres (optional)
# -----------------------
#
# Used if you want to record detections/events into a Postgres database.
#
# Runtime toggles:
# DB_ENABLED=1              # set to 1 to write detections into Postgres
# WILDLIFE_TABLE=wildlife   # table name (defaults to wildlife)
# VIDEO_SOURCE=bird_cam_1   # optional tag for where detections came from
#
# You can provide either:
# - DATABASE_URL (recommended), or
# - the standard libpq-style PG* variables below (also used by `psql`)
#
# DATABASE_URL example:
# DATABASE_URL=postgresql://bird:secret@192.168.0.10:5432/bird_detector
#
# PG* example:
# PGHOST=192.168.0.10
# PGPORT=5432
# PGDATABASE=bird_detector
# PGUSER=bird
# PGPASSWORD=secret
# PGSSLMODE=prefer
# PGCONNECT_TIMEOUT=3

